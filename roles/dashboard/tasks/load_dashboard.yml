---
- name: Set dashboard name
  set_fact:
    dashboard_name: "{{ item | basename | splitext | first }}"

# the dashboard_content is wrapped by '' to prevent the content
# being parsed has json which would result in the jinja2 template
# dealing with a dict.
- name: Load dashboard definition
  set_fact: 
    dashboard_content: "'{{ lookup('file', item) }}'"
  when: not deploy_local

- name: Define dashboard to Grafana
  command:
    cmd: oc -n {{ grafana_namespace }} apply -f - 
    stdin: "{{ lookup('template', 'dashboard.j2') }}"
  when: not deploy_local

- name: Define Dashboard to Local Grafana
  community.grafana.grafana_dashboard:
    grafana_url: http://localhost:3001
    grafana_user: "{{ grafana_user }}"
    grafana_password: "{{ grafana_password }}"
    state: present
    path: "{{ item }}"
  when: deploy_local